<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="js/fusionchart/fusioncharts.js"></script>
        <script type="text/javascript" src="js/fusionchart/fusioncharts.widgets.js"></script>
        <script src="js/tmi.min.js"></script>
    </head>
    <body>
        <script src="js/main.js"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                FusionCharts.ready(function () {
                    var updateAnnotation,
                            chart = new FusionCharts({
                                type: 'thermometer',
                                renderAt: 'salt-meter',
                                id: 'cs-salt-meter',
                                width: '240',
                                height: '310',
                                dataFormat: 'json',
                                dataSource: {
                                    "chart": {
                                        "caption": "Temperature Monitor",
                                        "lowerLimit": "0",
                                        "upperLimit": "100",
                                        "decimals": "1",
                                        "numberSuffix": "%",
                                        "showhovereffect": "0",
                                        "thmFillColor": "#008ee4",
                                        "showGaugeBorder": "1",
                                        "gaugeFillColor": "#FF0000",
                                        "gaugeBorderColor": "#008ee4",
                                        "gaugeBorderThickness": "2",
                                        "gaugeBorderAlpha": "30",
                                        "thmOriginX": "100",
                                        "chartBottomMargin": "20",
                                        "valueFontColor": "#000000",
                                        "theme": "fusion"
                                    },
                                    "value": "50",
                                    //All annotations are grouped under this element
                                    "annotations": {
                                        "showbelow": "101",
                                        "groups": [{
                                                //Each group needs a unique ID
                                                "id": "indicator",
                                                "items": [
                                                    //Showing Annotation
                                                    {
                                                        "id": "background",
                                                        //Rectangle item 
                                                        "type": "rectangle",
                                                        "alpha": "50",
                                                        "fillColor": "#AABBCC",
                                                        "x": "$gaugeEndX-40",
                                                        "tox": "$gaugeEndX",
                                                        "y": "$gaugeEndY+54",
                                                        "toy": "$gaugeEndY+72"
                                                    }]
                                            }]

                                    },
                                },
                                "events": {
                                    "initialized": function (evt, arg) {
                                        var dataUpdate = setInterval(function () {
                                            var value,
                                                    prevTemp = FusionCharts.items["myThm"].getData(),
                                                    mainTemp = (Math.random() * 10) * (-1),
                                                    diff = Math.abs(prevTemp - mainTemp);

                                            diff = diff > 1 ? (Math.random() * 1) : diff;
                                            if (mainTemp > prevTemp) {
                                                value = prevTemp + diff;
                                            } else {
                                                value = prevTemp - diff;
                                            }

                                            FusionCharts.items["myThm"].feedData("&value=" + value);

                                        }, 3000);
                                        updateAnnotation = function (evtObj, argObj) {
                                            var code,
                                                    chartObj = evtObj.sender,
                                                    val = chartObj.getData(),
                                                    annotations = chartObj.annotations;

                                            if (val >= -4.5) {
                                                code = "#00FF00";
                                            } else if (val < -4.5 && val > -6) {
                                                code = "#ff9900";
                                            } else {
                                                code = "#ff0000";
                                            }
                                            annotations.update("background", {
                                                "fillColor": code
                                            });
                                        };
                                    },
                                    "renderComplete": function (evt, arg) {
                                        updateAnnotation(evt, arg);
                                    },
                                    "realtimeUpdateComplete": function (evt, arg) {
                                        updateAnnotation(evt, arg);
                                    }
                                }
                            })
                            .render();
                });

                var client = new tmi.client(options);

                client.connect();

                client.on('connected', function (address, port) {
                    client.action("revenge0fthesm1th", "just connected!");
                });
                client.on('chat', function (channel, user, message, self) {
                    var regcheck = new RegExp("^!salt ([0-9]{0,3})$");

                    if (regcheck.test(message)) {
                        var result = message.split(" ");
                        var resultcheck = result[1];

                        if (resultcheck >= 0 && resultcheck <= 100) {
                            FusionCharts.items["cs-salt-meter"].feedData("value=" + resultcheck);
                        }
                    }
                });
            });
        </script>
        <br />
        <div id="salt-meter"></div>
    </body>
</html>